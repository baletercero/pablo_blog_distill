[
  {
    "path": "posts/2021-03-07-test-1-blog/",
    "title": "Census Housing Permits Forecasts",
    "description": "A simple exercise of forecasting census permits using Neural Prophet",
    "author": [
      {
        "name": "Pablo Tercero",
        "url": {}
      }
    ],
    "date": "2021-03-07",
    "categories": [],
    "contents": "\r\nThis notebook walks through the exercise of fitting a Prophet model on the census data provided at https://www.census.gov/construction/nrc/historical_data/index.html.\r\nIn particular we’ll use the Housing Units Authorized in Permit‐Issuing Places.\r\n As described in the [github page[(https://github.com/ourownstory/neural_prophet)] Neural Prophet is a time series model inspired by Facebook’s Prophet and AR-NET , built on PyTorch.\r\nLoad data\r\nI have stored the data downloaded from the census link above for permits in a file called permits_cust.xls , I read it with read_excel. And here’s what the data looks like :\r\n\r\n\r\npermits_raw <- read_excel('data/permits_cust.xls',sheet = 'PermitsUA', skip = 9,\r\n                          col_names = c('universe','date_unfmt','total','total_1unit',\r\n                                        'total_2to4units','total_5+units','ne_total',\r\n                                        'ne_1unit','mw_total','mw_1unit','south_total',\r\n                                        'south_1unit','west_total','west_1unit'),\r\n                          na = '(NA)')\r\n\r\n\r\n\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#fsjgcqrygd .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#fsjgcqrygd .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#fsjgcqrygd .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#fsjgcqrygd .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#fsjgcqrygd .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#fsjgcqrygd .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#fsjgcqrygd .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#fsjgcqrygd .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#fsjgcqrygd .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#fsjgcqrygd .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#fsjgcqrygd .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#fsjgcqrygd .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#fsjgcqrygd .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#fsjgcqrygd .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#fsjgcqrygd .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#fsjgcqrygd .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#fsjgcqrygd .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#fsjgcqrygd .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#fsjgcqrygd .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#fsjgcqrygd .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#fsjgcqrygd .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#fsjgcqrygd .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#fsjgcqrygd .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#fsjgcqrygd .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#fsjgcqrygd .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#fsjgcqrygd .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#fsjgcqrygd .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#fsjgcqrygd .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#fsjgcqrygd .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#fsjgcqrygd .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#fsjgcqrygd .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#fsjgcqrygd .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#fsjgcqrygd .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#fsjgcqrygd .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#fsjgcqrygd .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-size: 65%;\r\n}\r\nRaw permits data from census.gov\r\n    \r\n    universe\r\n      date_unfmt\r\n      total\r\n      total_1unit\r\n      total_2to4units\r\n      total_5+units\r\n    1959 Universe\r\n      21551\r\n      75.7\r\n      55.7\r\n      5.2\r\n      14.8\r\n    NA\r\n      21582\r\n      79.0\r\n      59.9\r\n      5.2\r\n      13.9\r\n    NA\r\n      21610\r\n      119.0\r\n      91.3\r\n      8.4\r\n      19.3\r\n    NA\r\n      21641\r\n      127.9\r\n      99.7\r\n      8.0\r\n      20.2\r\n    NA\r\n      21671\r\n      120.8\r\n      93.5\r\n      7.5\r\n      19.7\r\n    NA\r\n      21702\r\n      120.9\r\n      94.9\r\n      7.8\r\n      18.2\r\n    \r\n\r\nAfter a bit of cleanup , including converting to dates (months) , a sample of the data looks like this :\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#wxieuxjwdu .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#wxieuxjwdu .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#wxieuxjwdu .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#wxieuxjwdu .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#wxieuxjwdu .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#wxieuxjwdu .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#wxieuxjwdu .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#wxieuxjwdu .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#wxieuxjwdu .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#wxieuxjwdu .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#wxieuxjwdu .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#wxieuxjwdu .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#wxieuxjwdu .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#wxieuxjwdu .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#wxieuxjwdu .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#wxieuxjwdu .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#wxieuxjwdu .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#wxieuxjwdu .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#wxieuxjwdu .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#wxieuxjwdu .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#wxieuxjwdu .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#wxieuxjwdu .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#wxieuxjwdu .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#wxieuxjwdu .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#wxieuxjwdu .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#wxieuxjwdu .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#wxieuxjwdu .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#wxieuxjwdu .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#wxieuxjwdu .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#wxieuxjwdu .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#wxieuxjwdu .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#wxieuxjwdu .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#wxieuxjwdu .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#wxieuxjwdu .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#wxieuxjwdu .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-size: 65%;\r\n}\r\nRaw permits data from census.gov\r\n    \r\n    date\r\n      total\r\n      total_1unit\r\n      total_2to4units\r\n      total_5+units\r\n      ne_total\r\n    2005-06-01\r\n      211.9\r\n      166.2\r\n      8.7\r\n      37.1\r\n      22.1\r\n    2015-08-01\r\n      98.4\r\n      62.0\r\n      2.7\r\n      33.7\r\n      9.6\r\n    1982-07-01\r\n      92.2\r\n      46.8\r\n      7.3\r\n      38.1\r\n      9.2\r\n    2020-09-01\r\n      133.3\r\n      94.7\r\n      3.9\r\n      34.7\r\n      13.2\r\n    1988-03-01\r\n      140.4\r\n      98.2\r\n      7.7\r\n      34.5\r\n      24.6\r\n    2017-03-01\r\n      115.3\r\n      77.1\r\n      3.3\r\n      34.8\r\n      11.2\r\n    1972-11-01\r\n      176.8\r\n      76.5\r\n      11.6\r\n      88.7\r\n      33.7\r\n    1969-02-01\r\n      96.2\r\n      42.5\r\n      6.7\r\n      47.0\r\n      12.5\r\n    1996-05-01\r\n      140.5\r\n      109.2\r\n      6.2\r\n      25.1\r\n      14.2\r\n    2010-05-01\r\n      51.1\r\n      39.9\r\n      1.7\r\n      9.5\r\n      5.8\r\n    \r\n\r\nPlot\r\n\r\n\r\npermits %>% ggplot(aes(x=date,y=total)) + \r\n  geom_line(color='blue') + \r\n  labs(title = 'New Privately Owned Housing Units Authorized by Building Permits\\n \r\n       in Permit-Issuing Places', y='# of Housing Units *(K)', x= NULL, caption = 'Source: census.gov') +\r\n  #theme(axis.text.x = element_text(angle = 45)) +\r\n  scale_x_date(breaks = '5 years') +\r\n  theme_bw()\r\n\r\n\r\n\r\n\r\nThe API for Neural Prophet (NP) I found is written for Python , so this study turns to reticulate , the r library to interact with Python in RMarkdown. Below are some resources if you’re interested :\r\nGithub : https://rstudio.github.io/reticulate/\r\nRStudio video : https://docs.rstudio.com/tutorials/user/using-python-with-rstudio-and-reticulate/\r\nUsing python\r\nFirst , import the library , then check my anaconda environments (where I have python.exe) and finally choose the environment to use in this blog post\r\n\r\n\r\nlibrary(reticulate)\r\nconda_list()\r\n\r\n\r\n                                             name\r\n1                                        bayesian\r\n2                                     everycheese\r\n3                                     hellodjango\r\n4 mlflow-6284a367a61b51ccdf445333a216776597fb4efc\r\n5                                   neuralprophet\r\n6                             virtualEnvTensorGPU\r\n7                                virtualEnvTensor\r\n                                                                                         python\r\n1                                        C:\\\\ProgramData\\\\Anaconda3\\\\envs\\\\bayesian\\\\python.exe\r\n2                                     C:\\\\ProgramData\\\\Anaconda3\\\\envs\\\\everycheese\\\\python.exe\r\n3                                     C:\\\\ProgramData\\\\Anaconda3\\\\envs\\\\hellodjango\\\\python.exe\r\n4 C:\\\\ProgramData\\\\Anaconda3\\\\envs\\\\mlflow-6284a367a61b51ccdf445333a216776597fb4efc\\\\python.exe\r\n5                                   C:\\\\ProgramData\\\\Anaconda3\\\\envs\\\\neuralprophet\\\\python.exe\r\n6                             C:\\\\ProgramData\\\\Anaconda3\\\\envs\\\\virtualEnvTensorGPU\\\\python.exe\r\n7            C:\\\\Users\\\\pablo\\\\AppData\\\\Local\\\\conda\\\\conda\\\\envs\\\\virtualEnvTensor\\\\python.exe\r\n\r\nuse_condaenv('neuralprophet')\r\n\r\n\r\n\r\nThe data for the algorithm needs to be prepared (it wants the date on a column named ds and the variable to forecast in y).\r\n\r\npermits_total = r.permits[['date','total']].rename(columns={'date':'ds','total':'y'})\r\n\r\nI also create a train and test set with the intent of measuring the predictive capability of NP in data the model hasn’t seen\r\nTrain and test\r\nOne can also choose to create them based on holding out a part of the time series for testing\r\n\r\ntest_size = 120\r\ntrain_df = permits_total[:-test_size]\r\ntest_df = permits_total[-test_size:]\r\ntrain_df.head()\r\n           ds      y\r\n0  1959-01-01   75.7\r\n1  1959-02-01   79.0\r\n2  1959-03-01  119.0\r\n3  1959-04-01  127.9\r\n4  1959-05-01  120.8\r\n\r\nImport NeuralProphet\r\n\r\nfrom neuralprophet import NeuralProphet\r\n\r\nFit the model on training data\r\nHere’s where NP trains the model, since this is meant to evaluate the Neural Prophet , I choose the defaults. Perhaps in other blogs there can be a deep dive and tuning.\r\n\r\nm = NeuralProphet()\r\ntrain_fit = m.fit(train_df,freq='MS')\r\nWARNING: nprophet - fit: Parts of code may break if using other than daily data.\r\nC:\\PROGRA~3\\ANACON~1\\envs\\neuralprophet\\lib\\site-packages\\pandas\\core\\indexing.py:1676: SettingWithCopyWarning: \r\nA value is trying to be set on a copy of a slice from a DataFrame.\r\nTry using .loc[row_indexer,col_indexer] = value instead\r\n\r\nSee the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\r\n  self._setitem_single_column(ilocs[0], value, pi)\r\nINFO: nprophet.utils - set_auto_seasonalities: Disabling weekly seasonality. Run NeuralProphet with weekly_seasonality=True to override this.\r\nINFO: nprophet.utils - set_auto_seasonalities: Disabling daily seasonality. Run NeuralProphet with daily_seasonality=True to override this.\r\nINFO: nprophet.config - set_auto_batch_epoch: Auto-set batch_size to 8\r\nINFO: nprophet.config - set_auto_batch_epoch: Auto-set epochs to 51\r\n\r\n  0%|          | 0/100 [00:00<?, ?it/s]\r\n 90%|######### | 90/100 [00:00<00:00, 948.54it/s]\r\nINFO: nprophet - _lr_range_test: learning rate range test found optimal lr: 4.33E-01\r\n\r\n  0%|          | 0/51 [00:00<?, ?it/s]\r\nEpoch[1/51]:   0%|          | 0/51 [00:00<?, ?it/s]\r\nEpoch[1/51]:   0%|          | 0/51 [00:00<?, ?it/s, SmoothL1Loss=0.124, MAE=56.3, RegLoss=0]\r\nEpoch[2/51]:   0%|          | 0/51 [00:00<?, ?it/s, SmoothL1Loss=0.124, MAE=56.3, RegLoss=0]\r\nEpoch[2/51]:   0%|          | 0/51 [00:00<?, ?it/s, SmoothL1Loss=0.0218, MAE=26.5, RegLoss=0]\r\nEpoch[2/51]:   4%|3         | 2/51 [00:00<00:03, 12.66it/s, SmoothL1Loss=0.0218, MAE=26.5, RegLoss=0]\r\nEpoch[3/51]:   4%|3         | 2/51 [00:00<00:03, 12.66it/s, SmoothL1Loss=0.0218, MAE=26.5, RegLoss=0]\r\nEpoch[3/51]:   4%|3         | 2/51 [00:00<00:03, 12.66it/s, SmoothL1Loss=0.0245, MAE=28.6, RegLoss=0]\r\nEpoch[4/51]:   4%|3         | 2/51 [00:00<00:03, 12.66it/s, SmoothL1Loss=0.0245, MAE=28.6, RegLoss=0]\r\nEpoch[4/51]:   4%|3         | 2/51 [00:00<00:03, 12.66it/s, SmoothL1Loss=0.0296, MAE=31.1, RegLoss=0]\r\nEpoch[4/51]:   8%|7         | 4/51 [00:00<00:03, 12.88it/s, SmoothL1Loss=0.0296, MAE=31.1, RegLoss=0]\r\nEpoch[5/51]:   8%|7         | 4/51 [00:00<00:03, 12.88it/s, SmoothL1Loss=0.0296, MAE=31.1, RegLoss=0]\r\nEpoch[5/51]:   8%|7         | 4/51 [00:00<00:03, 12.88it/s, SmoothL1Loss=0.0477, MAE=39.4, RegLoss=0]\r\nEpoch[6/51]:   8%|7         | 4/51 [00:00<00:03, 12.88it/s, SmoothL1Loss=0.0477, MAE=39.4, RegLoss=0]\r\nEpoch[6/51]:   8%|7         | 4/51 [00:00<00:03, 12.88it/s, SmoothL1Loss=0.0734, MAE=49.4, RegLoss=0]\r\nEpoch[6/51]:  12%|#1        | 6/51 [00:00<00:03, 12.54it/s, SmoothL1Loss=0.0734, MAE=49.4, RegLoss=0]\r\nEpoch[7/51]:  12%|#1        | 6/51 [00:00<00:03, 12.54it/s, SmoothL1Loss=0.0734, MAE=49.4, RegLoss=0]\r\nEpoch[7/51]:  12%|#1        | 6/51 [00:00<00:03, 12.54it/s, SmoothL1Loss=0.179, MAE=73.7, RegLoss=0] \r\nEpoch[8/51]:  12%|#1        | 6/51 [00:00<00:03, 12.54it/s, SmoothL1Loss=0.179, MAE=73.7, RegLoss=0]\r\nEpoch[8/51]:  12%|#1        | 6/51 [00:00<00:03, 12.54it/s, SmoothL1Loss=0.155, MAE=70.4, RegLoss=0]\r\nEpoch[8/51]:  16%|#5        | 8/51 [00:00<00:03, 12.41it/s, SmoothL1Loss=0.155, MAE=70.4, RegLoss=0]\r\nEpoch[9/51]:  16%|#5        | 8/51 [00:00<00:03, 12.41it/s, SmoothL1Loss=0.155, MAE=70.4, RegLoss=0]\r\nEpoch[9/51]:  16%|#5        | 8/51 [00:00<00:03, 12.41it/s, SmoothL1Loss=0.147, MAE=68.6, RegLoss=0]\r\nEpoch[10/51]:  16%|#5        | 8/51 [00:00<00:03, 12.41it/s, SmoothL1Loss=0.147, MAE=68.6, RegLoss=0]\r\nEpoch[10/51]:  16%|#5        | 8/51 [00:00<00:03, 12.41it/s, SmoothL1Loss=0.179, MAE=77.5, RegLoss=0]\r\nEpoch[10/51]:  20%|#9        | 10/51 [00:00<00:03, 12.61it/s, SmoothL1Loss=0.179, MAE=77.5, RegLoss=0]\r\nEpoch[11/51]:  20%|#9        | 10/51 [00:00<00:03, 12.61it/s, SmoothL1Loss=0.179, MAE=77.5, RegLoss=0]\r\nEpoch[11/51]:  20%|#9        | 10/51 [00:00<00:03, 12.61it/s, SmoothL1Loss=0.116, MAE=57.6, RegLoss=0]\r\nEpoch[12/51]:  20%|#9        | 10/51 [00:00<00:03, 12.61it/s, SmoothL1Loss=0.116, MAE=57.6, RegLoss=0]\r\nEpoch[12/51]:  20%|#9        | 10/51 [00:00<00:03, 12.61it/s, SmoothL1Loss=0.279, MAE=97.8, RegLoss=0]\r\nEpoch[12/51]:  24%|##3       | 12/51 [00:00<00:03, 12.60it/s, SmoothL1Loss=0.279, MAE=97.8, RegLoss=0]\r\nEpoch[13/51]:  24%|##3       | 12/51 [00:01<00:03, 12.60it/s, SmoothL1Loss=0.279, MAE=97.8, RegLoss=0]\r\nEpoch[13/51]:  24%|##3       | 12/51 [00:01<00:03, 12.60it/s, SmoothL1Loss=0.364, MAE=116, RegLoss=0] \r\nEpoch[14/51]:  24%|##3       | 12/51 [00:01<00:03, 12.60it/s, SmoothL1Loss=0.364, MAE=116, RegLoss=0]\r\nEpoch[14/51]:  24%|##3       | 12/51 [00:01<00:03, 12.60it/s, SmoothL1Loss=0.537, MAE=147, RegLoss=0]\r\nEpoch[14/51]:  27%|##7       | 14/51 [00:01<00:02, 12.68it/s, SmoothL1Loss=0.537, MAE=147, RegLoss=0]\r\nEpoch[15/51]:  27%|##7       | 14/51 [00:01<00:02, 12.68it/s, SmoothL1Loss=0.537, MAE=147, RegLoss=0]\r\nEpoch[15/51]:  27%|##7       | 14/51 [00:01<00:02, 12.68it/s, SmoothL1Loss=0.377, MAE=119, RegLoss=0]\r\nEpoch[16/51]:  27%|##7       | 14/51 [00:01<00:02, 12.68it/s, SmoothL1Loss=0.377, MAE=119, RegLoss=0]\r\nEpoch[16/51]:  27%|##7       | 14/51 [00:01<00:02, 12.68it/s, SmoothL1Loss=0.31, MAE=101, RegLoss=0] \r\nEpoch[16/51]:  31%|###1      | 16/51 [00:01<00:02, 12.27it/s, SmoothL1Loss=0.31, MAE=101, RegLoss=0]\r\nEpoch[17/51]:  31%|###1      | 16/51 [00:01<00:02, 12.27it/s, SmoothL1Loss=0.31, MAE=101, RegLoss=0]\r\nEpoch[17/51]:  31%|###1      | 16/51 [00:01<00:02, 12.27it/s, SmoothL1Loss=0.196, MAE=73.5, RegLoss=0]\r\nEpoch[18/51]:  31%|###1      | 16/51 [00:01<00:02, 12.27it/s, SmoothL1Loss=0.196, MAE=73.5, RegLoss=0]\r\nEpoch[18/51]:  31%|###1      | 16/51 [00:01<00:02, 12.27it/s, SmoothL1Loss=0.207, MAE=80.1, RegLoss=0]\r\nEpoch[18/51]:  35%|###5      | 18/51 [00:01<00:02, 12.39it/s, SmoothL1Loss=0.207, MAE=80.1, RegLoss=0]\r\nEpoch[19/51]:  35%|###5      | 18/51 [00:01<00:02, 12.39it/s, SmoothL1Loss=0.207, MAE=80.1, RegLoss=0]\r\nEpoch[19/51]:  35%|###5      | 18/51 [00:01<00:02, 12.39it/s, SmoothL1Loss=0.181, MAE=78.7, RegLoss=0]\r\nEpoch[20/51]:  35%|###5      | 18/51 [00:01<00:02, 12.39it/s, SmoothL1Loss=0.181, MAE=78.7, RegLoss=0]\r\nEpoch[20/51]:  35%|###5      | 18/51 [00:01<00:02, 12.39it/s, SmoothL1Loss=0.483, MAE=136, RegLoss=0] \r\nEpoch[20/51]:  39%|###9      | 20/51 [00:01<00:02, 12.50it/s, SmoothL1Loss=0.483, MAE=136, RegLoss=0]\r\nEpoch[21/51]:  39%|###9      | 20/51 [00:01<00:02, 12.50it/s, SmoothL1Loss=0.483, MAE=136, RegLoss=0]\r\nEpoch[21/51]:  39%|###9      | 20/51 [00:01<00:02, 12.50it/s, SmoothL1Loss=0.291, MAE=96, RegLoss=0] \r\nEpoch[22/51]:  39%|###9      | 20/51 [00:01<00:02, 12.50it/s, SmoothL1Loss=0.291, MAE=96, RegLoss=0]\r\nEpoch[22/51]:  39%|###9      | 20/51 [00:01<00:02, 12.50it/s, SmoothL1Loss=0.111, MAE=57.5, RegLoss=0]\r\nEpoch[22/51]:  43%|####3     | 22/51 [00:01<00:02, 12.67it/s, SmoothL1Loss=0.111, MAE=57.5, RegLoss=0]\r\nEpoch[23/51]:  43%|####3     | 22/51 [00:01<00:02, 12.67it/s, SmoothL1Loss=0.111, MAE=57.5, RegLoss=0]\r\nEpoch[23/51]:  43%|####3     | 22/51 [00:01<00:02, 12.67it/s, SmoothL1Loss=0.171, MAE=73.6, RegLoss=0]\r\nEpoch[24/51]:  43%|####3     | 22/51 [00:01<00:02, 12.67it/s, SmoothL1Loss=0.171, MAE=73.6, RegLoss=0]\r\nEpoch[24/51]:  43%|####3     | 22/51 [00:01<00:02, 12.67it/s, SmoothL1Loss=0.133, MAE=63, RegLoss=0]  \r\nEpoch[24/51]:  47%|####7     | 24/51 [00:01<00:02, 12.74it/s, SmoothL1Loss=0.133, MAE=63, RegLoss=0]\r\nEpoch[25/51]:  47%|####7     | 24/51 [00:01<00:02, 12.74it/s, SmoothL1Loss=0.133, MAE=63, RegLoss=0]\r\nEpoch[25/51]:  47%|####7     | 24/51 [00:01<00:02, 12.74it/s, SmoothL1Loss=0.229, MAE=88, RegLoss=0]\r\nEpoch[26/51]:  47%|####7     | 24/51 [00:02<00:02, 12.74it/s, SmoothL1Loss=0.229, MAE=88, RegLoss=0]\r\nEpoch[26/51]:  47%|####7     | 24/51 [00:02<00:02, 12.74it/s, SmoothL1Loss=0.193, MAE=77.5, RegLoss=0]\r\nEpoch[26/51]:  51%|#####     | 26/51 [00:02<00:01, 12.74it/s, SmoothL1Loss=0.193, MAE=77.5, RegLoss=0]\r\nEpoch[27/51]:  51%|#####     | 26/51 [00:02<00:01, 12.74it/s, SmoothL1Loss=0.193, MAE=77.5, RegLoss=0]\r\nEpoch[27/51]:  51%|#####     | 26/51 [00:02<00:01, 12.74it/s, SmoothL1Loss=0.0925, MAE=55.4, RegLoss=0]\r\nEpoch[28/51]:  51%|#####     | 26/51 [00:02<00:01, 12.74it/s, SmoothL1Loss=0.0925, MAE=55.4, RegLoss=0]\r\nEpoch[28/51]:  51%|#####     | 26/51 [00:02<00:01, 12.74it/s, SmoothL1Loss=0.112, MAE=57.6, RegLoss=0] \r\nEpoch[28/51]:  55%|#####4    | 28/51 [00:02<00:01, 12.77it/s, SmoothL1Loss=0.112, MAE=57.6, RegLoss=0]\r\nEpoch[29/51]:  55%|#####4    | 28/51 [00:02<00:01, 12.77it/s, SmoothL1Loss=0.112, MAE=57.6, RegLoss=0]\r\nEpoch[29/51]:  55%|#####4    | 28/51 [00:02<00:01, 12.77it/s, SmoothL1Loss=0.141, MAE=66.6, RegLoss=0]\r\nEpoch[30/51]:  55%|#####4    | 28/51 [00:02<00:01, 12.77it/s, SmoothL1Loss=0.141, MAE=66.6, RegLoss=0]\r\nEpoch[30/51]:  55%|#####4    | 28/51 [00:02<00:01, 12.77it/s, SmoothL1Loss=0.0616, MAE=45.1, RegLoss=0]\r\nEpoch[30/51]:  59%|#####8    | 30/51 [00:02<00:01, 12.83it/s, SmoothL1Loss=0.0616, MAE=45.1, RegLoss=0]\r\nEpoch[31/51]:  59%|#####8    | 30/51 [00:02<00:01, 12.83it/s, SmoothL1Loss=0.0616, MAE=45.1, RegLoss=0]\r\nEpoch[31/51]:  59%|#####8    | 30/51 [00:02<00:01, 12.83it/s, SmoothL1Loss=0.109, MAE=59.2, RegLoss=0] \r\nEpoch[32/51]:  59%|#####8    | 30/51 [00:02<00:01, 12.83it/s, SmoothL1Loss=0.109, MAE=59.2, RegLoss=0]\r\nEpoch[32/51]:  59%|#####8    | 30/51 [00:02<00:01, 12.83it/s, SmoothL1Loss=0.0789, MAE=50.6, RegLoss=0]\r\nEpoch[32/51]:  63%|######2   | 32/51 [00:02<00:01, 12.82it/s, SmoothL1Loss=0.0789, MAE=50.6, RegLoss=0]\r\nEpoch[33/51]:  63%|######2   | 32/51 [00:02<00:01, 12.82it/s, SmoothL1Loss=0.0789, MAE=50.6, RegLoss=0]\r\nEpoch[33/51]:  63%|######2   | 32/51 [00:02<00:01, 12.82it/s, SmoothL1Loss=0.0425, MAE=37.3, RegLoss=0]\r\nEpoch[34/51]:  63%|######2   | 32/51 [00:02<00:01, 12.82it/s, SmoothL1Loss=0.0425, MAE=37.3, RegLoss=0]\r\nEpoch[34/51]:  63%|######2   | 32/51 [00:02<00:01, 12.82it/s, SmoothL1Loss=0.0646, MAE=46.1, RegLoss=0]\r\nEpoch[34/51]:  67%|######6   | 34/51 [00:02<00:01, 12.87it/s, SmoothL1Loss=0.0646, MAE=46.1, RegLoss=0]\r\nEpoch[35/51]:  67%|######6   | 34/51 [00:02<00:01, 12.87it/s, SmoothL1Loss=0.0646, MAE=46.1, RegLoss=0]\r\nEpoch[35/51]:  67%|######6   | 34/51 [00:02<00:01, 12.87it/s, SmoothL1Loss=0.0361, MAE=34.4, RegLoss=0]\r\nEpoch[36/51]:  67%|######6   | 34/51 [00:02<00:01, 12.87it/s, SmoothL1Loss=0.0361, MAE=34.4, RegLoss=0]\r\nEpoch[36/51]:  67%|######6   | 34/51 [00:02<00:01, 12.87it/s, SmoothL1Loss=0.0351, MAE=34.7, RegLoss=0]\r\nEpoch[36/51]:  71%|#######   | 36/51 [00:02<00:01, 12.94it/s, SmoothL1Loss=0.0351, MAE=34.7, RegLoss=0]\r\nEpoch[37/51]:  71%|#######   | 36/51 [00:02<00:01, 12.94it/s, SmoothL1Loss=0.0351, MAE=34.7, RegLoss=0]\r\nEpoch[37/51]:  71%|#######   | 36/51 [00:02<00:01, 12.94it/s, SmoothL1Loss=0.0446, MAE=38.5, RegLoss=0]\r\nEpoch[38/51]:  71%|#######   | 36/51 [00:02<00:01, 12.94it/s, SmoothL1Loss=0.0446, MAE=38.5, RegLoss=0]\r\nEpoch[38/51]:  71%|#######   | 36/51 [00:02<00:01, 12.94it/s, SmoothL1Loss=0.0511, MAE=38.3, RegLoss=0]\r\nEpoch[38/51]:  75%|#######4  | 38/51 [00:02<00:01, 12.88it/s, SmoothL1Loss=0.0511, MAE=38.3, RegLoss=0]\r\nEpoch[39/51]:  75%|#######4  | 38/51 [00:03<00:01, 12.88it/s, SmoothL1Loss=0.0511, MAE=38.3, RegLoss=0]\r\nEpoch[39/51]:  75%|#######4  | 38/51 [00:03<00:01, 12.88it/s, SmoothL1Loss=0.0309, MAE=32.4, RegLoss=0]\r\nEpoch[40/51]:  75%|#######4  | 38/51 [00:03<00:01, 12.88it/s, SmoothL1Loss=0.0309, MAE=32.4, RegLoss=0]\r\nEpoch[40/51]:  75%|#######4  | 38/51 [00:03<00:01, 12.88it/s, SmoothL1Loss=0.0254, MAE=29.2, RegLoss=0]\r\nEpoch[40/51]:  78%|#######8  | 40/51 [00:03<00:00, 12.91it/s, SmoothL1Loss=0.0254, MAE=29.2, RegLoss=0]\r\nEpoch[41/51]:  78%|#######8  | 40/51 [00:03<00:00, 12.91it/s, SmoothL1Loss=0.0254, MAE=29.2, RegLoss=0]\r\nEpoch[41/51]:  78%|#######8  | 40/51 [00:03<00:00, 12.91it/s, SmoothL1Loss=0.0254, MAE=29.1, RegLoss=0]\r\nEpoch[42/51]:  78%|#######8  | 40/51 [00:03<00:00, 12.91it/s, SmoothL1Loss=0.0254, MAE=29.1, RegLoss=0]\r\nEpoch[42/51]:  78%|#######8  | 40/51 [00:03<00:00, 12.91it/s, SmoothL1Loss=0.0233, MAE=27.6, RegLoss=0]\r\nEpoch[42/51]:  82%|########2 | 42/51 [00:03<00:00, 12.91it/s, SmoothL1Loss=0.0233, MAE=27.6, RegLoss=0]\r\nEpoch[43/51]:  82%|########2 | 42/51 [00:03<00:00, 12.91it/s, SmoothL1Loss=0.0233, MAE=27.6, RegLoss=0]\r\nEpoch[43/51]:  82%|########2 | 42/51 [00:03<00:00, 12.91it/s, SmoothL1Loss=0.0238, MAE=28, RegLoss=0]  \r\nEpoch[44/51]:  82%|########2 | 42/51 [00:03<00:00, 12.91it/s, SmoothL1Loss=0.0238, MAE=28, RegLoss=0]\r\nEpoch[44/51]:  82%|########2 | 42/51 [00:03<00:00, 12.91it/s, SmoothL1Loss=0.0225, MAE=27.7, RegLoss=0]\r\nEpoch[44/51]:  86%|########6 | 44/51 [00:03<00:00, 12.93it/s, SmoothL1Loss=0.0225, MAE=27.7, RegLoss=0]\r\nEpoch[45/51]:  86%|########6 | 44/51 [00:03<00:00, 12.93it/s, SmoothL1Loss=0.0225, MAE=27.7, RegLoss=0]\r\nEpoch[45/51]:  86%|########6 | 44/51 [00:03<00:00, 12.93it/s, SmoothL1Loss=0.022, MAE=26.9, RegLoss=0] \r\nEpoch[46/51]:  86%|########6 | 44/51 [00:03<00:00, 12.93it/s, SmoothL1Loss=0.022, MAE=26.9, RegLoss=0]\r\nEpoch[46/51]:  86%|########6 | 44/51 [00:03<00:00, 12.93it/s, SmoothL1Loss=0.0218, MAE=26.6, RegLoss=0]\r\nEpoch[46/51]:  90%|######### | 46/51 [00:03<00:00, 12.92it/s, SmoothL1Loss=0.0218, MAE=26.6, RegLoss=0]\r\nEpoch[47/51]:  90%|######### | 46/51 [00:03<00:00, 12.92it/s, SmoothL1Loss=0.0218, MAE=26.6, RegLoss=0]\r\nEpoch[47/51]:  90%|######### | 46/51 [00:03<00:00, 12.92it/s, SmoothL1Loss=0.0196, MAE=25.3, RegLoss=0]\r\nEpoch[48/51]:  90%|######### | 46/51 [00:03<00:00, 12.92it/s, SmoothL1Loss=0.0196, MAE=25.3, RegLoss=0]\r\nEpoch[48/51]:  90%|######### | 46/51 [00:03<00:00, 12.92it/s, SmoothL1Loss=0.019, MAE=25, RegLoss=0]   \r\nEpoch[48/51]:  94%|#########4| 48/51 [00:03<00:00, 12.92it/s, SmoothL1Loss=0.019, MAE=25, RegLoss=0]\r\nEpoch[49/51]:  94%|#########4| 48/51 [00:03<00:00, 12.92it/s, SmoothL1Loss=0.019, MAE=25, RegLoss=0]\r\nEpoch[49/51]:  94%|#########4| 48/51 [00:03<00:00, 12.92it/s, SmoothL1Loss=0.0185, MAE=24.5, RegLoss=0]\r\nEpoch[50/51]:  94%|#########4| 48/51 [00:03<00:00, 12.92it/s, SmoothL1Loss=0.0185, MAE=24.5, RegLoss=0]\r\nEpoch[50/51]:  94%|#########4| 48/51 [00:03<00:00, 12.92it/s, SmoothL1Loss=0.018, MAE=24.1, RegLoss=0] \r\nEpoch[50/51]:  98%|#########8| 50/51 [00:03<00:00, 12.97it/s, SmoothL1Loss=0.018, MAE=24.1, RegLoss=0]\r\nEpoch[51/51]:  98%|#########8| 50/51 [00:03<00:00, 12.97it/s, SmoothL1Loss=0.018, MAE=24.1, RegLoss=0]\r\nEpoch[51/51]:  98%|#########8| 50/51 [00:03<00:00, 12.97it/s, SmoothL1Loss=0.0178, MAE=24, RegLoss=0] \r\nEpoch[51/51]: 100%|##########| 51/51 [00:03<00:00, 12.75it/s, SmoothL1Loss=0.0178, MAE=24, RegLoss=0]\r\n\r\n\r\ntrain_fit.tail()\r\n    SmoothL1Loss        MAE  RegLoss\r\n46      0.019637  25.322689      0.0\r\n47      0.019031  25.021062      0.0\r\n48      0.018476  24.525203      0.0\r\n49      0.018019  24.121631      0.0\r\n50      0.017810  24.023309      0.0\r\n\r\nSide note\r\nIt is worth noting that NP provides a method to get train and test :\r\nBut a different method to obtain train and test was used here.\r\n(Fit) Validation metrics\r\n\r\nval_metrics = m.test(test_df)\r\nC:\\PROGRA~3\\ANACON~1\\envs\\neuralprophet\\lib\\site-packages\\pandas\\core\\indexing.py:1676: SettingWithCopyWarning: \r\nA value is trying to be set on a copy of a slice from a DataFrame.\r\nTry using .loc[row_indexer,col_indexer] = value instead\r\n\r\nSee the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\r\n  self._setitem_single_column(ilocs[0], value, pi)\r\nINFO: nprophet - _evaluate: Validation metrics:    SmoothL1Loss    MAE\r\n1         0.019 24.430\r\nval_metrics\r\n   SmoothL1Loss        MAE\r\n0      0.018507  24.429792\r\n\r\nThese are the metrics provided by the API for the fit , however , below , a presentation of the author’s method for calculating the holdout forecast accuracy based on own work and experience.\r\nAlternative way to validate\r\nCreate a test dataset starting from the end of training and predict using the trained model\r\nNote : Had to use the m.make_future_dataframe as it creates its own structure to send to predict\r\n\r\nfuture = m.make_future_dataframe(train_df, periods=120)\r\nfuture.head()\r\n          ds     y         t y_scaled\r\n0 2011-02-01  None  1.001632      NaN\r\n1 2011-03-01  None  1.003106      NaN\r\n2 2011-04-01  None  1.004739      NaN\r\n3 2011-05-01  None  1.006318      NaN\r\n4 2011-06-01  None  1.007950      NaN\r\nholdout_fcst = m.predict(future)\r\n\r\nPlot the predictions\r\n\r\nm.plot(holdout_fcst);\r\nplt.show()\r\n\r\n\r\nNow a dataset with the acutals and forecasts is created to measure accuracy\r\n\r\ndf_final = pd.merge(permits_total, holdout_fcst[['ds','yhat1']], on='ds', how='left')\r\ndf_final.tail()\r\n            ds      y       yhat1\r\n740 2020-09-01  133.3  117.671341\r\n741 2020-10-01  132.9  115.515945\r\n742 2020-11-01  120.0   99.538391\r\n743 2020-12-01  133.6   94.645309\r\n744 2021-01-01  128.8   81.659882\r\n\r\n\r\ndf_final['abs_error'] = abs(df_final['y']-df_final['yhat1'])\r\ndf_final.tail()\r\n            ds      y       yhat1  abs_error\r\n740 2020-09-01  133.3  117.671341  15.628659\r\n741 2020-10-01  132.9  115.515945  17.384055\r\n742 2020-11-01  120.0   99.538391  20.461609\r\n743 2020-12-01  133.6   94.645309  38.954691\r\n744 2021-01-01  128.8   81.659882  47.140118\r\n\r\nSMAPE is used but evidently other measures can be similarly be calculated\r\n\r\n\r\npy$df_final %>% as_tibble() %>% rename(actuals=y,forecasts=yhat1) %>% \r\n  mutate(ds = ymd(as.Date(ds))) %>% \r\n  filter(!is.na(abs_error)) %>% \r\n  filter(ds>ymd('2020-01-01')) %>% \r\n  summarise(across(-ds,sum)) %>% \r\n  mutate(avg_act_fcst = (actuals+forecasts)/2,\r\n         smape = abs_error/avg_act_fcst,\r\n         accuracy = percent(1-smape,accuracy = 0.01) )\r\n\r\n\r\n# A tibble: 1 x 6\r\n  actuals forecasts abs_error avg_act_fcst smape accuracy\r\n    <dbl>     <dbl>     <dbl>        <dbl> <dbl> <chr>   \r\n1   1451.     1356.      249.        1403. 0.178 82.24%  \r\n\r\nPlot of actuals and forecasts\r\n\r\n\r\npy$df_final %>% as_tibble() %>% rename(actuals=y,forecasts=yhat1) %>% \r\n  pivot_longer(cols = c(actuals,forecasts), names_to = 'series') %>% \r\n  ggplot(aes(ds,value,color=series)) + geom_line() + theme_bw()\r\n\r\n\r\n\r\n\r\nIt is clear that just using past history it would have been (and still is) hard to accurately predict the rather noticeable growth in permits even in the midst of a pandemic\r\nPredict one year into the future\r\n\r\nfuture = m.make_future_dataframe(permits_total, periods=12)\r\nforecast = m.predict(future)\r\n\r\nPlot the predictions\r\n\r\nm.plot(forecast);\r\nplt.show()\r\n\r\n\r\nIt’s also possible to do the plot in R by referencing the forecast object with py$forecast\r\n\r\n\r\npy$forecast %>% as_tibble() %>% mutate(ds = as.Date(ds)) %>% \r\n  ggplot(aes(ds,yhat1)) + geom_line() + scale_x_date(breaks = '1 month') +\r\n  labs(title = 'Forecasts for Holdout period' , y='K permits', x=NULL)\r\n\r\n\r\n\r\n\r\nThere are some nice features from the library (quite similar if not identical than the ones from Facebook prophet’s api)\r\nThese are the time series components .\r\n\r\nm.plot_components(forecast);\r\nplt.show()\r\n\r\n\r\nAnd the parameters of the fit can also be displayed\r\n\r\nm.plot_parameters();\r\nplt.show()\r\n\r\n\r\nI really enjoyed creating this notebook and experimenting with NeuralProphet , I hope you do to , please reach out with comments and feedback if you share the interest in forecasting.\r\n\r\n\r\n\r\n",
    "preview": "posts/2021-03-07-test-1-blog/distill-preview.png",
    "last_modified": "2021-03-28T19:42:33-05:00",
    "input_file": "test-1-blog.utf8.md",
    "preview_width": 1248,
    "preview_height": 768
  },
  {
    "path": "posts/welcome/",
    "title": "Welcome to My Distill Blog",
    "description": "Welcome to my new blog. I hope you enjoy \nreading what we have to say!",
    "author": [
      {
        "name": "Pablo Tercero",
        "url": "https://baledatascience.netlify.app/"
      }
    ],
    "date": "2021-02-28",
    "categories": [],
    "contents": "\r\nThis is my first attempt at creating a small personal website for blog posts I create to solidify my understanding of data science concepts, techniques, libraries ,etc…\r\nSoon I will complete this blog with a forecasting project , housing permits predictions using Orbit\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
    "preview": "posts/welcome/distill-preview.png",
    "last_modified": "2021-03-14T18:19:36-05:00",
    "input_file": {},
    "preview_width": 918,
    "preview_height": 280
  }
]
